<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LernTrainer ‚Äì Interaktiv lernen f√ºr Klasse 7-10</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d;
            --primary-light: #2c5282;
            --secondary: #2b6cb0;
            --accent: #ed8936;
            --success: #38a169;
            --error: #e53e3e;
            --warning: #d69e2e;
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
        }

        /* ==================== LOGIN SCREEN ==================== */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 24px;
            padding: 50px 40px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            text-align: center;
        }

        .login-logo { font-size: 4rem; margin-bottom: 10px; }
        .login-title { font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 8px; }
        .login-subtitle { color: var(--text-light); margin-bottom: 30px; font-size: 1.05rem; }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.1rem;
            font-family: inherit;
            border: 3px solid var(--border);
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(43, 108, 176, 0.15);
        }

        .login-input.error {
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: inherit;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(26, 54, 93, 0.3);
        }

        .login-error { color: var(--error); font-size: 0.9rem; margin-top: 15px; display: none; }
        .login-error.show { display: block; }
        .login-hint { margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border); color: var(--text-light); font-size: 0.85rem; }

        /* ==================== MAIN APP ==================== */
        .app-container { display: none; max-width: 1100px; margin: 0 auto; padding: 20px; }
        .app-container.show { display: block; }

        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .app-header-left { display: flex; align-items: center; gap: 15px; }
        .app-header-logo { font-size: 2.5rem; }
        .app-header h1 { font-size: 1.6rem; font-weight: 700; }
        .app-header p { opacity: 0.9; font-size: 0.95rem; }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover { background: rgba(255,255,255,0.3); }

        /* Progress */
        .progress-section {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .progress-title { font-weight: 600; color: var(--primary); }
        .progress-stats { font-size: 0.9rem; color: var(--text-light); }
        .progress-bar { height: 12px; background: var(--border); border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--success), #48bb78); border-radius: 6px; transition: width 0.5s ease; }

        /* Selection */
        .selection-section {
            background: var(--card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        .selection-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .selection-btn {
            padding: 20px 15px;
            border: 3px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
            text-align: center;
        }

        .selection-btn:hover:not(.disabled) {
            border-color: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .selection-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, #ebf8ff, #e6fffa);
        }

        .selection-btn .icon { font-size: 2rem; margin-bottom: 8px; display: block; }
        .selection-btn .label { font-weight: 600; color: var(--text); font-size: 0.95rem; }

        /* Topic Cards */
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .topic-card {
            padding: 20px;
            border: 3px solid var(--border);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .topic-card:hover:not(.disabled):not(.coming-soon) {
            border-color: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .topic-card.coming-soon { opacity: 0.6; cursor: not-allowed; }

        .topic-card.coming-soon::after {
            content: "Bald verf√ºgbar";
            position: absolute;
            top: 10px;
            right: -30px;
            background: var(--warning);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 4px 35px;
            transform: rotate(45deg);
        }

        .topic-card .topic-icon { font-size: 1.5rem; margin-bottom: 10px; }
        .topic-card .topic-name { font-weight: 600; color: var(--primary); font-size: 1.05rem; margin-bottom: 5px; }
        .topic-card .topic-desc { font-size: 0.85rem; color: var(--text-light); line-height: 1.4; }
        .topic-card .topic-meta { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }

        .topic-tag { font-size: 0.75rem; padding: 4px 10px; border-radius: 15px; font-weight: 600; }
        .topic-tag.questions { background: #ebf8ff; color: var(--secondary); }
        .topic-tag.audio { background: #f0fff4; color: var(--success); }
        .topic-tag.completed { background: #c6f6d5; color: #276749; }

        /* Breadcrumb */
        .breadcrumb { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--card);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .breadcrumb-item.clickable { cursor: pointer; transition: all 0.3s ease; }
        .breadcrumb-item.clickable:hover { background: var(--border); }
        .breadcrumb-arrow { color: var(--text-light); }

        /* Document Upload Section */
        .upload-section {
            background: linear-gradient(135deg, #faf5ff, #f0fff4);
            border: 2px dashed var(--secondary);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .upload-section p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .upload-area {
            background: white;
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .upload-area:hover {
            border-color: var(--secondary);
            background: #f0f9ff;
        }

        .upload-area.dragover {
            border-color: var(--success);
            background: #f0fff4;
        }

        .upload-icon { font-size: 3rem; margin-bottom: 10px; }
        .upload-text { color: var(--text); font-weight: 500; }
        .upload-hint { font-size: 0.8rem; color: var(--text-light); margin-top: 5px; }

        .upload-input { display: none; }

        .uploaded-files {
            text-align: left;
            margin-top: 15px;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .uploaded-file-info { display: flex; align-items: center; gap: 10px; }
        .uploaded-file-icon { font-size: 1.2rem; }
        .uploaded-file-name { font-weight: 500; font-size: 0.9rem; }
        .uploaded-file-size { font-size: 0.8rem; color: var(--text-light); }

        .uploaded-file-remove {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }

        .upload-instructions {
            background: #fffbeb;
            border: 1px solid var(--warning);
            border-radius: 10px;
            padding: 15px;
            text-align: left;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .upload-instructions strong { color: var(--primary); }
        .upload-instructions code {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
        }

        /* Document Preview */
        .document-preview {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }

        .document-preview h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .document-preview pre {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }

        /* Quiz Container */
        .quiz-container {
            background: var(--card);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            display: none;
        }

        .quiz-container.show { display: block; }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 25px;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover { border-color: var(--secondary); color: var(--secondary); }

        /* Quiz Stats */
        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .quiz-stat {
            background: var(--bg);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .quiz-stat-value { font-size: 1.4rem; font-weight: 700; font-family: 'Space Mono', monospace; }
        .quiz-stat-label { font-size: 0.75rem; color: var(--text-light); }
        .quiz-stat.correct .quiz-stat-value { color: var(--success); }
        .quiz-stat.wrong .quiz-stat-value { color: var(--error); }
        .quiz-stat.percent .quiz-stat-value { color: var(--accent); }

        /* Audio Toggle */
        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #ebf8ff, #e6fffa);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .mode-toggle-label { font-weight: 600; color: var(--primary); }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 32px;
            background: var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active { background: var(--success); }

        .toggle-switch::after {
            content: "";
            position: absolute;
            top: 4px;
            left: 4px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after { left: 32px; }
        .mode-toggle-desc { font-size: 0.85rem; color: var(--text-light); }

        /* Question Area */
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-type-badge {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .question-tense-badge {
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .question-number { font-family: 'Space Mono', monospace; color: var(--text-light); font-size: 0.85rem; }
        .question-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 20px; }

        .sentence-box {
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, #edf2f7, #e2e8f0);
            padding: 18px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 1rem;
            line-height: 1.8;
            border-left: 4px solid var(--secondary);
        }

        /* Audio Controls */
        .audio-controls { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }

        .audio-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .audio-btn.speak { background: linear-gradient(135deg, #4299e1, #3182ce); color: white; }
        .audio-btn.listen { background: linear-gradient(135deg, var(--success), #2f855a); color: white; }
        .audio-btn:hover { transform: scale(1.05); }
        .audio-btn.speaking, .audio-btn.listening { animation: pulse 1s infinite; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Voice Visualizer */
        .voice-visualizer {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .voice-visualizer.active { display: flex; }

        .voice-bar {
            width: 6px;
            height: 30px;
            background: white;
            border-radius: 3px;
            animation: voiceBar 0.5s ease-in-out infinite;
        }

        .voice-bar:nth-child(1) { animation-delay: 0s; }
        .voice-bar:nth-child(2) { animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voiceBar {
            0%, 100% { height: 10px; opacity: 0.5; }
            50% { height: 40px; opacity: 1; }
        }

        .voice-status { color: white; font-weight: 600; margin-left: 15px; }

        .recognized-text {
            background: #ebf8ff;
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Space Mono', monospace;
            min-height: 50px;
            display: none;
        }

        .recognized-text.show { display: block; }
        .recognized-text .label { font-size: 0.8rem; color: var(--text-light); margin-bottom: 5px; font-family: 'Outfit', sans-serif; }

        /* Answer Input */
        .answer-input {
            width: 100%;
            padding: 16px 18px;
            font-size: 1rem;
            font-family: 'Space Mono', monospace;
            border: 3px solid var(--border);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            background: var(--bg);
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: white;
            box-shadow: 0 0 0 4px rgba(43, 108, 176, 0.15);
        }

        .answer-input.correct { border-color: var(--success); background: #f0fff4; }
        .answer-input.incorrect { border-color: var(--error); background: #fff5f5; }

        /* Options */
        .options-grid { display: grid; gap: 10px; margin-bottom: 15px; }

        .option-btn {
            padding: 15px 18px;
            border: 3px solid var(--border);
            background: var(--bg);
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--secondary);
            background: white;
            transform: translateX(5px);
        }

        .option-btn.selected { border-color: var(--primary); background: #ebf8ff; }
        .option-btn.correct { border-color: var(--success); background: #f0fff4; }
        .option-btn.incorrect { border-color: var(--error); background: #fff5f5; }
        .option-btn.disabled { cursor: default; }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        /* Buttons */
        .btn-row { display: flex; gap: 12px; flex-wrap: wrap; }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 54, 93, 0.3);
        }

        .btn-secondary { background: var(--border); color: var(--text); }
        .btn-secondary:hover { background: #cbd5e0; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Feedback */
        .feedback { padding: 18px; border-radius: 12px; margin-top: 15px; display: none; }
        .feedback.show { display: block; animation: slideIn 0.4s ease; }
        .feedback.correct { background: linear-gradient(135deg, #c6f6d5, #9ae6b4); border-left: 5px solid var(--success); }
        .feedback.incorrect { background: linear-gradient(135deg, #fed7d7, #feb2b2); border-left: 5px solid var(--error); }
        .feedback-title { font-weight: 700; font-size: 1.05rem; margin-bottom: 8px; }
        .feedback-text { line-height: 1.6; }
        .correct-answer { font-family: 'Space Mono', monospace; background: rgba(255,255,255,0.8); padding: 4px 10px; border-radius: 6px; font-weight: 600; }

        /* Result */
        .result-screen { text-align: center; padding: 40px 20px; display: none; }
        .result-screen.show { display: block; }
        .result-emoji { font-size: 70px; margin-bottom: 15px; }
        .result-title { font-size: 1.8rem; color: var(--primary); margin-bottom: 12px; }
        .result-score { font-size: 2.8rem; font-weight: 700; color: var(--success); font-family: 'Space Mono', monospace; }
        .result-text { color: var(--text-light); margin-bottom: 25px; }

        /* Theory */
        .theory-toggle {
            background: none;
            border: 2px solid var(--secondary);
            color: var(--secondary);
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .theory-toggle:hover { background: var(--secondary); color: white; }

        .theory-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .theory-section.show { display: block; }
        .theory-section h3 { color: var(--primary); margin-bottom: 12px; }
        .theory-section h4 { color: var(--secondary); margin: 15px 0 8px; }

        .theory-section table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 0.9rem; }
        .theory-section th, .theory-section td { padding: 10px; border: 1px solid var(--border); text-align: left; }
        .theory-section th { background: var(--primary); color: white; }
        .theory-section code { background: #edf2f7; padding: 2px 6px; border-radius: 4px; font-family: 'Space Mono', monospace; }
        .rule-box { background: #ebf8ff; border: 2px solid var(--secondary); padding: 12px; border-radius: 8px; margin: 12px 0; }
        .example-box { background: #fffbeb; border-left: 4px solid var(--accent); padding: 12px; margin: 12px 0; border-radius: 0 8px 8px 0; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-header { flex-direction: column; text-align: center; }
            .app-header-left { flex-direction: column; }
            .selection-grid { grid-template-columns: repeat(2, 1fr); }
            .quiz-stats { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 480px) {
            .login-box { padding: 30px 20px; }
            .selection-grid { grid-template-columns: 1fr 1fr; }
            .topic-grid { grid-template-columns: 1fr; }
            .btn { width: 100%; justify-content: center; }
            .audio-btn { flex: 1; justify-content: center; }
        }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">üéì</div>
            <h1 class="login-title">LernTrainer</h1>
            <p class="login-subtitle">Interaktiv lernen f√ºr Klasse 7-10</p>
            <input type="password" class="login-input" id="passwordInput" placeholder="Passwort eingeben" autocomplete="off">
            <button class="login-btn" id="loginBtn">üîì Anmelden</button>
            <p class="login-error" id="loginError">‚ùå Falsches Passwort.</p>
            <p class="login-hint">üí° Das Passwort erh√§ltst du von deiner Lehrkraft.</p>
        </div>
    </div>

    <!-- APP -->
    <div class="app-container" id="appContainer">
        <header class="app-header">
            <div class="app-header-left">
                <span class="app-header-logo">üéì</span>
                <div>
                    <h1>LernTrainer</h1>
                    <p>Willkommen zur√ºck!</p>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">üö™ Abmelden</button>
        </header>

        <div class="progress-section" id="progressSection">
            <div class="progress-header">
                <span class="progress-title">üìä Dein Gesamtfortschritt</span>
                <span class="progress-stats" id="progressStats">0 Module abgeschlossen</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <div class="breadcrumb" id="breadcrumb"></div>

        <!-- Grade Selection -->
        <div class="selection-section" id="gradeSelection">
            <h2 class="selection-title">üìö W√§hle deine Klassenstufe</h2>
            <div class="selection-grid" id="gradeGrid"></div>
        </div>

        <!-- Subject Selection -->
        <div class="selection-section" id="subjectSelection" style="display: none;">
            <h2 class="selection-title">üìñ W√§hle ein Fach</h2>
            <div class="selection-grid" id="subjectGrid"></div>
        </div>

        <!-- Topic Selection -->
        <div class="selection-section" id="topicSelection" style="display: none;">
            <h2 class="selection-title">üéØ W√§hle ein Thema</h2>
            <div class="topic-grid" id="topicGrid"></div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection" style="display: none;">
            <h3>üìÑ Eigene Materialien hochladen</h3>
            <p>Lade Arbeitsbl√§tter, Lehrbuchausz√ºge oder Notizen hoch, um sie als Lernmaterial zu nutzen.</p>
            
            <div class="upload-area" id="uploadArea">
                <input type="file" class="upload-input" id="uploadInput" accept=".txt,.md,.pdf,.doc,.docx" multiple>
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">Dateien hierher ziehen oder klicken</div>
                <div class="upload-hint">Unterst√ºtzt: .txt, .md (PDF/Word: nur Dateiname wird angezeigt)</div>
            </div>

            <div class="uploaded-files" id="uploadedFiles"></div>

            <div class="document-preview" id="documentPreview" style="display: none;">
                <h4>üìã Hochgeladener Inhalt:</h4>
                <pre id="documentContent"></pre>
            </div>

            <div class="upload-instructions">
                <strong>üí° So erstellst du √úbungen aus deinen Materialien:</strong><br><br>
                1. Kopiere den hochgeladenen Text<br>
                2. √ñffne <code>claude.ai</code><br>
                3. F√ºge diesen Prompt ein:<br><br>
                <code>"Erstelle 15 √úbungsaufgaben im LernTrainer-Format (fillblank, choice, transform) zu folgendem Material: [DEIN TEXT]"</code><br><br>
                4. Die generierten Fragen kannst du in den LernTrainer einf√ºgen.
            </div>
        </div>

        <!-- Quiz -->
        <div class="quiz-container" id="quizContainer">
            <button class="back-btn" id="backToTopics">‚Üê Zur√ºck zur Themenauswahl</button>
            
            <div class="mode-toggle" id="modeToggle">
                <span class="mode-toggle-label">üé§ Audio-Modus</span>
                <div class="toggle-switch" id="audioToggle"></div>
                <span class="mode-toggle-desc">Fragen h√∂ren, Antworten sprechen</span>
            </div>

            <button class="theory-toggle" id="theoryToggle">üìñ Theorie anzeigen</button>
            <div class="theory-section" id="theorySection"></div>

            <div class="quiz-stats" id="quizStats">
                <div class="quiz-stat"><div class="quiz-stat-value" id="statTotal">0</div><div class="quiz-stat-label">Fragen</div></div>
                <div class="quiz-stat correct"><div class="quiz-stat-value" id="statCorrect">0</div><div class="quiz-stat-label">Richtig</div></div>
                <div class="quiz-stat wrong"><div class="quiz-stat-value" id="statWrong">0</div><div class="quiz-stat-label">Falsch</div></div>
                <div class="quiz-stat percent"><div class="quiz-stat-value" id="statPercent">0%</div><div class="quiz-stat-label">Quote</div></div>
            </div>

            <div id="questionArea">
                <div class="question-header">
                    <span class="question-type-badge" id="questionType">L√ºckentext</span>
                    <span class="question-tense-badge" id="questionTense">Thema</span>
                    <span class="question-number" id="questionNumber">Frage 1/12</span>
                </div>

                <div class="audio-controls" id="audioControls" style="display: none;">
                    <button class="audio-btn speak" id="speakBtn">üîä Vorlesen</button>
                    <button class="audio-btn listen" id="listenBtn">üé§ Sprechen</button>
                </div>

                <div class="voice-visualizer" id="voiceVisualizer">
                    <div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div>
                    <span class="voice-status" id="voiceStatus">Ich h√∂re zu...</span>
                </div>

                <div class="recognized-text" id="recognizedText">
                    <div class="label">Erkannt:</div>
                    <div id="recognizedContent"></div>
                </div>

                <div class="question-text" id="questionText"></div>
                <div id="answerArea"></div>

                <div class="feedback" id="feedback">
                    <div class="feedback-title" id="feedbackTitle"></div>
                    <div class="feedback-text" id="feedbackText"></div>
                </div>

                <div class="btn-row">
                    <button class="btn btn-primary" id="checkBtn">‚úì √úberpr√ºfen</button>
                    <button class="btn btn-secondary" id="nextBtn" style="display: none;">N√§chste Frage ‚Üí</button>
                </div>
            </div>

            <div class="result-screen" id="resultScreen">
                <div class="result-emoji" id="resultEmoji">üéâ</div>
                <h2 class="result-title" id="resultTitle">Super gemacht!</h2>
                <div class="result-score" id="resultScore">80%</div>
                <p class="result-text" id="resultText">Du hast 8 von 10 Fragen richtig.</p>
                <div class="btn-row" style="justify-content: center;">
                    <button class="btn btn-primary" id="restartBtn">üîÑ Nochmal √ºben</button>
                    <button class="btn btn-secondary" id="backToTopicsResult">üìö Andere Themen</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =====================================================
        // CONFIGURATION
        // =====================================================
        const CONFIG = {
            password: "lernen2024",
            questionsPerQuiz: 12
        };

        // =====================================================
        // DATA
        // =====================================================
        const GRADES = [
            { id: 7, name: "Klasse 7", icon: "7Ô∏è‚É£" },
            { id: 8, name: "Klasse 8", icon: "8Ô∏è‚É£" },
            { id: 9, name: "Klasse 9", icon: "9Ô∏è‚É£" },
            { id: 10, name: "Klasse 10", icon: "üîü" }
        ];

        const SUBJECTS = [
            { id: "englisch", name: "Englisch", icon: "üá¨üáß" },
            { id: "deutsch", name: "Deutsch", icon: "üìù" },
            { id: "mathe", name: "Mathematik", icon: "üìê" },
            { id: "franzoesisch", name: "Franz√∂sisch", icon: "üá´üá∑" },
            { id: "geschichte", name: "Geschichte", icon: "üèõÔ∏è" },
            { id: "biologie", name: "Biologie", icon: "üß¨" },
            { id: "physik", name: "Physik", icon: "‚ö°" },
            { id: "chemie", name: "Chemie", icon: "üß™" }
        ];

        const TOPICS = {
            // ==================== KLASSE 7 ====================
            "7-englisch": [
                {
                    id: "passive-voice",
                    name: "Passive Voice",
                    desc: "Das Passiv in verschiedenen Zeitformen",
                    icon: "üîÑ",
                    questions: 15,
                    hasAudio: true,
                    audioLang: "en-GB",
                    theory: `<h3>üìö Das Passive Voice</h3>
                        <div class="rule-box"><strong>Grundregel:</strong> Passiv = Form von <code>be</code> + <code>past participle</code></div>
                        <table><tr><th>Zeitform</th><th>Form</th><th>Beispiel</th></tr>
                        <tr><td>Simple Present</td><td>am/is/are + pp</td><td>English <strong>is spoken</strong> here.</td></tr>
                        <tr><td>Simple Past</td><td>was/were + pp</td><td>The house <strong>was built</strong> in 1950.</td></tr>
                        <tr><td>Present Perfect</td><td>have/has been + pp</td><td>The letter <strong>has been sent</strong>.</td></tr></table>`,
                    questionData: [
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "English _____ (speak) in many countries.", answer: "is spoken", alternativeAnswers: ["English is spoken in many countries"], tense: "Simple Present" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "The house _____ (build) in 1950.", answer: "was built", alternativeAnswers: ["The house was built in 1950"], tense: "Simple Past" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "The letter _____ already _____ (send).", answer: "has already been sent", alternativeAnswers: ["has been sent"], tense: "Present Perfect" },
                        { type: "transform", instruction: "Wandle ins Passive um:", sentence: "They speak English here.", answer: "English is spoken here.", alternativeAnswers: [], tense: "Simple Present" },
                        { type: "transform", instruction: "Wandle ins Passive um:", sentence: "Someone stole my bike.", answer: "My bike was stolen.", alternativeAnswers: [], tense: "Simple Past" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "Haggis _____ (make) from sheep's stomach.", answer: "is made", alternativeAnswers: [], tense: "Simple Present" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "Penicillin _____ (discover) by Alexander Fleming.", answer: "was discovered", alternativeAnswers: [], tense: "Simple Past" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "Whisky _____ (produce) in Scotland for centuries.", answer: "has been produced", alternativeAnswers: [], tense: "Present Perfect" },
                        { type: "choice", instruction: "W√§hle die richtige Passivform:", sentence: "The windows _____ every week.", options: ["is cleaned", "are cleaned", "was cleaned", "were cleaned"], correctIndex: 1, tense: "Simple Present" },
                        { type: "choice", instruction: "W√§hle die richtige Passivform:", sentence: "The car _____ yesterday.", options: ["is repaired", "are repaired", "was repaired", "were repaired"], correctIndex: 2, tense: "Simple Past" },
                        { type: "transform", instruction: "Wandle ins Passive um:", sentence: "People have read this book many times.", answer: "This book has been read many times.", alternativeAnswers: [], tense: "Present Perfect" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "Ships _____ (build) in Glasgow.", answer: "are built", alternativeAnswers: [], tense: "Simple Present" },
                        { type: "choice", instruction: "Welcher Satz ist Passive?", sentence: "", options: ["She writes letters.", "Letters are written.", "They build houses.", "He reads books."], correctIndex: 1, tense: "Erkennung" },
                        { type: "transform", instruction: "Wandle ins Passive um:", sentence: "They clean the rooms every day.", answer: "The rooms are cleaned every day.", alternativeAnswers: [], tense: "Simple Present" },
                        { type: "fillblank", instruction: "Setze die richtige Passivform ein:", sentence: "The Sherlock Holmes stories _____ (write) by Conan Doyle.", answer: "were written", alternativeAnswers: [], tense: "Simple Past" }
                    ]
                }
            ],
            "7-mathe": [
                {
                    id: "kommutativgesetz",
                    name: "Kommutativgesetz",
                    desc: "Vertauschungsgesetz bei Addition und Multiplikation",
                    icon: "üîÄ",
                    questions: 15,
                    hasAudio: false,
                    theory: `<h3>üìö Das Kommutativgesetz</h3>
                        <div class="rule-box"><strong>Definition:</strong> Bei Addition und Multiplikation darf man die Reihenfolge der Zahlen vertauschen, ohne dass sich das Ergebnis √§ndert.</div>
                        <h4>Addition</h4>
                        <div class="example-box"><code>a + b = b + a</code><br>Beispiel: <code>3 + 5 = 5 + 3 = 8</code></div>
                        <h4>Multiplikation</h4>
                        <div class="example-box"><code>a ¬∑ b = b ¬∑ a</code><br>Beispiel: <code>4 ¬∑ 7 = 7 ¬∑ 4 = 28</code></div>
                        <h4>‚ö†Ô∏è Achtung!</h4>
                        <div class="rule-box">Das Kommutativgesetz gilt <strong>NICHT</strong> f√ºr Subtraktion und Division!<br>
                        <code>5 - 3 ‚â† 3 - 5</code> und <code>8 : 2 ‚â† 2 : 8</code></div>`,
                    questionData: [
                        { type: "choice", instruction: "Bei welcher Rechenart gilt das Kommutativgesetz?", sentence: "", options: ["Nur Addition", "Nur Multiplikation", "Addition und Multiplikation", "Alle vier Grundrechenarten"], correctIndex: 2, tense: "Grundlagen" },
                        { type: "fillblank", instruction: "Wende das Kommutativgesetz an:", sentence: "7 + 12 = 12 + _____", answer: "7", alternativeAnswers: [], tense: "Addition" },
                        { type: "fillblank", instruction: "Wende das Kommutativgesetz an:", sentence: "9 ¬∑ 4 = _____ ¬∑ 9", answer: "4", alternativeAnswers: [], tense: "Multiplikation" },
                        { type: "choice", instruction: "Welche Gleichung ist korrekt?", sentence: "", options: ["15 - 8 = 8 - 15", "6 ¬∑ 11 = 11 ¬∑ 6", "20 : 4 = 4 : 20", "Keine davon"], correctIndex: 1, tense: "Anwendung" },
                        { type: "fillblank", instruction: "Berechne geschickt mit dem Kommutativgesetz:", sentence: "17 + 45 + 3 = 17 + 3 + 45 = _____ + 45 = _____", answer: "65", alternativeAnswers: ["20 + 45 = 65"], tense: "Rechentrick" },
                        { type: "choice", instruction: "Warum gilt 8 - 3 ‚â† 3 - 8?", sentence: "", options: ["Weil das Ergebnis negativ wird", "Weil Subtraktion nicht kommutativ ist", "Beides ist richtig", "Weil 3 kleiner als 8 ist"], correctIndex: 2, tense: "Verst√§ndnis" },
                        { type: "fillblank", instruction: "Setze ein:", sentence: "a + b = _____ + a", answer: "b", alternativeAnswers: [], tense: "Formel" },
                        { type: "fillblank", instruction: "Setze ein:", sentence: "x ¬∑ y = y ¬∑ _____", answer: "x", alternativeAnswers: [], tense: "Formel" },
                        { type: "choice", instruction: "Berechne geschickt: 25 ¬∑ 7 ¬∑ 4", sentence: "", options: ["175 ¬∑ 4 = 700", "25 ¬∑ 4 ¬∑ 7 = 100 ¬∑ 7 = 700", "Beides f√ºhrt zum gleichen Ergebnis", "Das geht nicht"], correctIndex: 2, tense: "Rechentrick" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "13 + 27 + 7 = 13 + 7 + 27 = _____ + 27 = 47", answer: "20", alternativeAnswers: [], tense: "Rechentrick" },
                        { type: "choice", instruction: "Welche Aussage ist FALSCH?", sentence: "", options: ["3 + 5 = 5 + 3", "6 ¬∑ 2 = 2 ¬∑ 6", "10 - 4 = 4 - 10", "100 ¬∑ 1 = 1 ¬∑ 100"], correctIndex: 2, tense: "Erkennung" },
                        { type: "fillblank", instruction: "Berechne mit Kommutativgesetz:", sentence: "4 ¬∑ 17 ¬∑ 25 = 4 ¬∑ 25 ¬∑ 17 = _____ ¬∑ 17 = _____", answer: "1700", alternativeAnswers: ["100 ¬∑ 17 = 1700"], tense: "Rechentrick" },
                        { type: "choice", instruction: "Das Kommutativgesetz hei√üt auch:", sentence: "", options: ["Vertauschungsgesetz", "Verbindungsgesetz", "Verteilungsgesetz", "Umkehrgesetz"], correctIndex: 0, tense: "Begriff" },
                        { type: "fillblank", instruction: "F√ºlle aus:", sentence: "F√ºr die _____ und _____ gilt das Kommutativgesetz.", answer: "Addition und Multiplikation", alternativeAnswers: ["Addition, Multiplikation", "Multiplikation und Addition"], tense: "Definition" },
                        { type: "choice", instruction: "Welche Rechnung nutzt das Kommutativgesetz clever?", sentence: "", options: ["99 + 47 = 100 + 46", "8 ¬∑ 125 = 125 ¬∑ 8 = 1000", "50 - 25 = 25", "144 : 12 = 12"], correctIndex: 1, tense: "Anwendung" }
                    ]
                }
            ],
            "7-deutsch": [
                {
                    id: "argumentieren",
                    name: "Argumentieren",
                    desc: "Stellung beziehen, Argumente anf√ºhren, Beispiele geben",
                    icon: "üí¨",
                    questions: 25,
                    hasAudio: false,
                    theory: `<h3>üìö Richtig Argumentieren</h3>
                        <div class="rule-box"><strong>Die drei Schritte einer guten Argumentation:</strong><br><br>
                        <strong>1. Stellung beziehen (These)</strong><br>
                        ‚Üí Deine Meinung klar und deutlich formulieren<br><br>
                        <strong>2. Argument anf√ºhren (Begr√ºndung)</strong><br>
                        ‚Üí Erkl√§ren, WARUM du so denkst<br><br>
                        <strong>3. Beispiel anf√ºgen (Beleg)</strong><br>
                        ‚Üí Mit einem konkreten Beispiel untermauern</div>
                        
                        <h4>Beispiel einer vollst√§ndigen Argumentation:</h4>
                        <div class="example-box">
                        <strong>These:</strong> "Ich bin der Meinung, dass der Schulbeginn auf 9 Uhr verschoben werden sollte."<br><br>
                        <strong>Argument:</strong> "Jugendliche brauchen mehr Schlaf als Erwachsene, und Schlafmangel f√ºhrt zu Konzentrationsproblemen."<br><br>
                        <strong>Beispiel:</strong> "Studien zeigen, dass Sch√ºler an Schulen mit sp√§terem Beginn bessere Noten haben. In meiner Klasse sind morgens viele m√ºde und unkonzentriert."</div>
                        
                        <h4>Wichtige Formulierungshilfen:</h4>
                        <table><tr><th>F√ºr...</th><th>Formulierungen</th></tr>
                        <tr><td>These</td><td>Ich bin der Meinung, dass... / Meiner Ansicht nach... / Ich finde, dass...</td></tr>
                        <tr><td>Argument</td><td>...weil / ...denn / Ein wichtiger Grund ist... / Das liegt daran, dass...</td></tr>
                        <tr><td>Beispiel</td><td>Zum Beispiel... / Das zeigt sich daran, dass... / Ein Beleg daf√ºr ist...</td></tr></table>
                        
                        <h4>Tipps f√ºr starke Argumente:</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Sachlich bleiben, nicht beleidigend werden</li>
                        <li>Fakten und Beispiele nutzen</li>
                        <li>Auch die Gegenseite bedenken</li>
                        <li>Vom st√§rksten zum schw√§chsten Argument ordnen</li>
                        </ul>`,
                    questionData: [
                        // === GRUNDLAGEN: Was ist was? ===
                        { type: "choice", instruction: "Was ist der ERSTE Schritt beim Argumentieren?", sentence: "", options: ["Ein Beispiel nennen", "Stellung beziehen (These)", "Ein Argument anf√ºhren", "Die Gegenmeinung nennen"], correctIndex: 1, tense: "Grundlagen" },
                        { type: "choice", instruction: "Was ist eine THESE?", sentence: "", options: ["Ein Beweis f√ºr etwas", "Eine Frage", "Eine Behauptung/Meinung", "Ein Beispiel"], correctIndex: 2, tense: "Grundlagen" },
                        { type: "choice", instruction: "Wozu dient ein ARGUMENT?", sentence: "", options: ["Um die These zu begr√ºnden", "Um ein Beispiel zu geben", "Um die Gegenseite zu beleidigen", "Um das Thema zu wechseln"], correctIndex: 0, tense: "Grundlagen" },
                        { type: "choice", instruction: "Wozu dient ein BEISPIEL in der Argumentation?", sentence: "", options: ["Um vom Thema abzulenken", "Um das Argument zu belegen und anschaulich zu machen", "Um die Meinung zu √§ndern", "Um lustig zu sein"], correctIndex: 1, tense: "Grundlagen" },
                        { type: "fillblank", instruction: "Erg√§nze die richtige Reihenfolge:", sentence: "1. These ‚Üí 2. _____ ‚Üí 3. Beispiel", answer: "Argument", alternativeAnswers: ["Begr√ºndung", "Argumente"], tense: "Grundlagen" },
                        
                        // === ERKENNUNG: Was ist das? ===
                        { type: "choice", instruction: "Um welchen Teil einer Argumentation handelt es sich?", sentence: "\"Ich bin der Meinung, dass Hausaufgaben abgeschafft werden sollten.\"", options: ["Beispiel", "Argument", "These", "Gegenargument"], correctIndex: 2, tense: "Erkennung" },
                        { type: "choice", instruction: "Um welchen Teil einer Argumentation handelt es sich?", sentence: "\"...denn Sch√ºler haben nach der Schule kaum noch Freizeit f√ºr Hobbys und Erholung.\"", options: ["These", "Argument", "Beispiel", "Einleitung"], correctIndex: 1, tense: "Erkennung" },
                        { type: "choice", instruction: "Um welchen Teil einer Argumentation handelt es sich?", sentence: "\"Mein Freund Max muss jeden Tag zwei Stunden Hausaufgaben machen und kann deshalb nicht mehr zum Fu√üballtraining.\"", options: ["These", "Argument", "Beispiel", "Schluss"], correctIndex: 2, tense: "Erkennung" },
                        { type: "choice", instruction: "Um welchen Teil einer Argumentation handelt es sich?", sentence: "\"Meiner Ansicht nach sollten alle Sch√ºler ein Tablet im Unterricht nutzen d√ºrfen.\"", options: ["Argument", "Beispiel", "Gegenargument", "These"], correctIndex: 3, tense: "Erkennung" },
                        { type: "choice", instruction: "Um welchen Teil einer Argumentation handelt es sich?", sentence: "\"In Finnland haben Schulen den Tablet-Einsatz getestet und die Sch√ºler waren motivierter.\"", options: ["These", "Argument", "Beispiel", "Meinung"], correctIndex: 2, tense: "Erkennung" },
                        
                        // === FORMULIERUNGSHILFEN ===
                        { type: "fillblank", instruction: "Welches Wort leitet ein ARGUMENT ein?", sentence: "Handys sollten in der Schule erlaubt sein, _____ man sie f√ºr Recherchen nutzen kann.", answer: "weil", alternativeAnswers: ["denn", "da"], tense: "Formulierung" },
                        { type: "fillblank", instruction: "Welche Formulierung leitet eine THESE ein?", sentence: "_____ bin ich davon √ºberzeugt, dass Sport wichtig f√ºr die Gesundheit ist.", answer: "Deshalb", alternativeAnswers: ["Daher", "Darum", "Aus diesem Grund"], tense: "Formulierung" },
                        { type: "fillblank", instruction: "Welche Formulierung leitet ein BEISPIEL ein?", sentence: "_____ zeigt die Studie der Universit√§t Hamburg, dass Bewegung die Konzentration f√∂rdert.", answer: "Zum Beispiel", alternativeAnswers: ["Beispielsweise", "So", "Das zeigt sich daran"], tense: "Formulierung" },
                        { type: "choice", instruction: "Welche Formulierung eignet sich f√ºr eine THESE?", sentence: "", options: ["Zum Beispiel...", "Ich bin der Meinung, dass...", "Das liegt daran, dass...", "Au√üerdem..."], correctIndex: 1, tense: "Formulierung" },
                        { type: "choice", instruction: "Welches Wort verbindet These und Argument?", sentence: "", options: ["obwohl", "trotzdem", "weil/denn", "aber"], correctIndex: 2, tense: "Formulierung" },
                        
                        // === ZUORDNUNG: Was passt zusammen? ===
                        { type: "choice", instruction: "Welches Beispiel passt zum Argument \"Haustiere f√∂rdern das Verantwortungsbewusstsein\"?", sentence: "", options: ["Hunde sind s√º√ü.", "Meine Schwester f√ºttert t√§glich ihren Hamster und k√ºmmert sich um sein Gehege.", "Katzen schlafen viel.", "Haustiere kosten Geld."], correctIndex: 1, tense: "Zuordnung" },
                        { type: "choice", instruction: "Welches Argument passt zur These \"Schuluniformen sollten eingef√ºhrt werden\"?", sentence: "", options: ["Uniformen sind teuer.", "Dadurch gibt es weniger Mobbing wegen Kleidung.", "Ich mag keine Uniformen.", "Meine Freunde finden das auch doof."], correctIndex: 1, tense: "Zuordnung" },
                        { type: "choice", instruction: "Welches Beispiel passt NICHT zum Thema \"Handyverbot in der Schule\"?", sentence: "", options: ["In Frankreich sind Handys an Schulen verboten.", "Mein Bruder isst gerne Pizza.", "Eine Studie zeigt, dass Sch√ºler ohne Handy konzentrierter sind.", "In unserer Schule gab es schon Streit wegen Handy-Videos."], correctIndex: 1, tense: "Zuordnung" },
                        
                        // === BEWERTUNG: Stark oder schwach? ===
                        { type: "choice", instruction: "Welches ist das ST√ÑRKERE Argument f√ºr Schuluniformen?", sentence: "", options: ["Uniformen sind praktisch.", "Niemand wird wegen seiner Kleidung geh√§nselt, was Mobbing reduziert.", "Mein Onkel findet Uniformen gut.", "In England gibt es auch Uniformen."], correctIndex: 1, tense: "Bewertung" },
                        { type: "choice", instruction: "Welches Argument ist SCHWACH, weil es nur eine pers√∂nliche Meinung ohne Begr√ºndung ist?", sentence: "", options: ["Hausaufgaben helfen, den Stoff zu wiederholen.", "Ich finde Hausaufgaben einfach doof.", "Studien zeigen, dass moderates √úben den Lernerfolg steigert.", "Viele Sch√ºler haben durch Hausaufgaben wenig Freizeit."], correctIndex: 1, tense: "Bewertung" },
                        { type: "choice", instruction: "Was macht ein Argument STARK?", sentence: "", options: ["Es ist sehr lang.", "Es enth√§lt Schimpfw√∂rter.", "Es ist sachlich und enth√§lt Fakten oder nachvollziehbare Gr√ºnde.", "Es wiederholt nur die These."], correctIndex: 2, tense: "Bewertung" },
                        
                        // === STRUKTUR ERKENNEN ===
                        { type: "choice", instruction: "Welche Argumentation ist VOLLST√ÑNDIG (These + Argument + Beispiel)?", sentence: "", options: [
                            "Ich finde Hunde toll. Mein Nachbar hat einen Hund.",
                            "Haustiere sind gut f√ºr Kinder, weil sie Verantwortung lernen. Meine Schwester k√ºmmert sich t√§glich um ihren Hamster.",
                            "Katzen sind s√º√ü. Katzen schnurren. Katzen schlafen viel.",
                            "Meiner Meinung nach sollte man Sport machen."
                        ], correctIndex: 1, tense: "Struktur" },
                        { type: "choice", instruction: "Was FEHLT in dieser Argumentation: \"Ich finde, Sch√ºler sollten sp√§ter zur Schule kommen. In Seattle wurde der Schulbeginn auf 8:45 Uhr verschoben und die Noten wurden besser.\"", sentence: "", options: ["Die These", "Das Argument (Begr√ºndung)", "Das Beispiel", "Nichts, sie ist vollst√§ndig"], correctIndex: 1, tense: "Struktur" },
                        { type: "choice", instruction: "Was FEHLT hier: \"Vegetarische Ern√§hrung ist ges√ºnder, weil sie weniger ges√§ttigte Fette enth√§lt und das Herzinfarkt-Risiko senkt.\"", sentence: "", options: ["Die These", "Das Argument", "Ein konkretes Beispiel", "Alles ist vorhanden"], correctIndex: 2, tense: "Struktur" },
                        
                        // === ANWENDUNG: Themen durchdenken ===
                        { type: "choice", instruction: "Du sollst F√úR ein Handyverbot in der Schule argumentieren. Welches Argument passt?", sentence: "", options: [
                            "Handys sind teuer.",
                            "Ohne Handys konzentrieren sich Sch√ºler besser auf den Unterricht.",
                            "Meine Eltern haben mir ein neues Handy gekauft.",
                            "In anderen L√§ndern gibt es auch Handys."
                        ], correctIndex: 1, tense: "Anwendung" },
                        { type: "choice", instruction: "Du sollst GEGEN Hausaufgaben argumentieren. Welches ist das beste Argument?", sentence: "", options: [
                            "Hausaufgaben sind langweilig.",
                            "Mein Freund macht auch keine Hausaufgaben.",
                            "Nach 6 Stunden Schule brauchen Sch√ºler Erholung, um am n√§chsten Tag wieder konzentriert zu sein.",
                            "Lehrer geben zu viele Hausaufgaben."
                        ], correctIndex: 2, tense: "Anwendung" }
                    ]
                }
            ],
            "7-franzoesisch": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "7-geschichte": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "7-biologie": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "7-physik": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "7-chemie": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],

            // ==================== KLASSE 9 ====================
            "9-englisch": [
                {
                    id: "australia",
                    name: "Australia",
                    desc: "Landeskunde, Geschichte und Kultur Australiens",
                    icon: "ü¶ò",
                    questions: 18,
                    hasAudio: true,
                    audioLang: "en-AU",
                    theory: `<h3>üá¶üá∫ Australia - Facts & Figures</h3>
                        <div class="rule-box"><strong>Basic Facts:</strong><br>
                        ‚Ä¢ Capital: Canberra<br>‚Ä¢ Largest city: Sydney<br>‚Ä¢ Population: ~26 million<br>‚Ä¢ Area: 7.7 million km¬≤ (6th largest country)</div>
                        <h4>Geography</h4>
                        <p>Australia is both a country and a continent. It's surrounded by the Pacific and Indian Oceans. The interior (Outback) is mostly desert.</p>
                        <h4>Indigenous Culture</h4>
                        <p>Aboriginal Australians have lived there for over 65,000 years - one of the oldest continuous cultures on Earth.</p>
                        <h4>Famous Landmarks</h4>
                        <p>Sydney Opera House, Uluru (Ayers Rock), Great Barrier Reef, Harbour Bridge</p>
                        <h4>Wildlife</h4>
                        <p>Unique animals: Kangaroo, Koala, Platypus, Wombat, Emu, many dangerous snakes and spiders</p>`,
                    questionData: [
                        { type: "choice", instruction: "What is the capital of Australia?", sentence: "", options: ["Sydney", "Melbourne", "Canberra", "Brisbane"], correctIndex: 2, tense: "Geography" },
                        { type: "choice", instruction: "What is the largest city in Australia?", sentence: "", options: ["Melbourne", "Sydney", "Perth", "Adelaide"], correctIndex: 1, tense: "Geography" },
                        { type: "fillblank", instruction: "Complete the sentence:", sentence: "Australia is both a country and a _____.", answer: "continent", alternativeAnswers: [], tense: "Geography" },
                        { type: "choice", instruction: "How long have Aboriginal Australians lived in Australia?", sentence: "", options: ["About 10,000 years", "About 25,000 years", "Over 65,000 years", "About 5,000 years"], correctIndex: 2, tense: "History" },
                        { type: "fillblank", instruction: "Complete:", sentence: "The famous rock in central Australia is called _____ or Ayers Rock.", answer: "Uluru", alternativeAnswers: [], tense: "Landmarks" },
                        { type: "choice", instruction: "Which ocean is NOT next to Australia?", sentence: "", options: ["Pacific Ocean", "Indian Ocean", "Atlantic Ocean", "Southern Ocean"], correctIndex: 2, tense: "Geography" },
                        { type: "fillblank", instruction: "Complete:", sentence: "The _____ Barrier Reef is the world's largest coral reef system.", answer: "Great", alternativeAnswers: [], tense: "Nature" },
                        { type: "choice", instruction: "Which animal is NOT native to Australia?", sentence: "", options: ["Kangaroo", "Koala", "Tiger", "Platypus"], correctIndex: 2, tense: "Wildlife" },
                        { type: "fillblank", instruction: "Complete:", sentence: "The dry interior of Australia is called the _____.", answer: "Outback", alternativeAnswers: [], tense: "Geography" },
                        { type: "choice", instruction: "Which famous building is in Sydney?", sentence: "", options: ["Big Ben", "Eiffel Tower", "Opera House", "Colosseum"], correctIndex: 2, tense: "Landmarks" },
                        { type: "fillblank", instruction: "Complete:", sentence: "Australia's population is approximately _____ million people.", answer: "26", alternativeAnswers: ["25", "27"], tense: "Facts" },
                        { type: "choice", instruction: "What is a 'koala'?", sentence: "", options: ["A type of bear", "A marsupial", "A reptile", "A bird"], correctIndex: 1, tense: "Wildlife" },
                        { type: "fillblank", instruction: "Complete:", sentence: "The Sydney Harbour _____ is a famous steel arch bridge.", answer: "Bridge", alternativeAnswers: [], tense: "Landmarks" },
                        { type: "choice", instruction: "When is summer in Australia?", sentence: "", options: ["June to August", "March to May", "December to February", "September to November"], correctIndex: 2, tense: "Climate" },
                        { type: "fillblank", instruction: "Complete:", sentence: "A baby kangaroo is called a _____.", answer: "joey", alternativeAnswers: [], tense: "Wildlife" },
                        { type: "choice", instruction: "What language is spoken in Australia?", sentence: "", options: ["Australian", "British", "English", "American"], correctIndex: 2, tense: "Culture" },
                        { type: "fillblank", instruction: "Complete:", sentence: "Australia is the _____ largest country in the world by area.", answer: "sixth", alternativeAnswers: ["6th"], tense: "Facts" },
                        { type: "choice", instruction: "What is the 'Outback'?", sentence: "", options: ["A city", "The coastal area", "The remote interior", "A mountain range"], correctIndex: 2, tense: "Geography" }
                    ]
                }
            ],
            "9-mathe": [
                {
                    id: "gleichungen-variablen",
                    name: "Gleichungen mit Variablen",
                    desc: "Lineare Gleichungen l√∂sen und umformen",
                    icon: "üî¢",
                    questions: 18,
                    hasAudio: false,
                    theory: `<h3>üìö Gleichungen mit Variablen</h3>
                        <div class="rule-box"><strong>Grundprinzip:</strong> Eine Gleichung ist wie eine Waage - was du auf einer Seite tust, musst du auch auf der anderen tun!</div>
                        <h4>√Ñquivalenzumformungen</h4>
                        <table><tr><th>Umformung</th><th>Beispiel</th></tr>
                        <tr><td>Beide Seiten + Zahl</td><td>x - 5 = 3 ‚Üí x = 8</td></tr>
                        <tr><td>Beide Seiten - Zahl</td><td>x + 7 = 12 ‚Üí x = 5</td></tr>
                        <tr><td>Beide Seiten ¬∑ Zahl</td><td>x/4 = 3 ‚Üí x = 12</td></tr>
                        <tr><td>Beide Seiten : Zahl</td><td>3x = 15 ‚Üí x = 5</td></tr></table>
                        <h4>Gleichungen mit Klammern</h4>
                        <div class="example-box">2(x + 3) = 14<br>2x + 6 = 14<br>2x = 8<br>x = 4</div>
                        <h4>Gleichungen mit x auf beiden Seiten</h4>
                        <div class="example-box">5x + 2 = 3x + 10<br>2x + 2 = 10<br>2x = 8<br>x = 4</div>`,
                    questionData: [
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "x + 7 = 15 ‚Üí x = _____", answer: "8", alternativeAnswers: [], tense: "Einfach" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "x - 4 = 9 ‚Üí x = _____", answer: "13", alternativeAnswers: [], tense: "Einfach" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "3x = 21 ‚Üí x = _____", answer: "7", alternativeAnswers: [], tense: "Einfach" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "x/5 = 4 ‚Üí x = _____", answer: "20", alternativeAnswers: [], tense: "Einfach" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "2x + 5 = 17 ‚Üí x = _____", answer: "6", alternativeAnswers: [], tense: "Mittel" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "4x - 3 = 25 ‚Üí x = _____", answer: "7", alternativeAnswers: [], tense: "Mittel" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "5x + 8 = 3x + 20 ‚Üí x = _____", answer: "6", alternativeAnswers: [], tense: "Beidseitig" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung:", sentence: "7x - 4 = 4x + 11 ‚Üí x = _____", answer: "5", alternativeAnswers: [], tense: "Beidseitig" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung mit Klammer:", sentence: "2(x + 4) = 18 ‚Üí x = _____", answer: "5", alternativeAnswers: [], tense: "Klammern" },
                        { type: "fillblank", instruction: "L√∂se die Gleichung mit Klammer:", sentence: "3(x - 2) = 15 ‚Üí x = _____", answer: "7", alternativeAnswers: [], tense: "Klammern" },
                        { type: "choice", instruction: "Welcher erste Schritt ist richtig f√ºr: 2x + 8 = 20?", sentence: "", options: ["x 2 teilen", "8 subtrahieren", "20 addieren", "Klammer aufl√∂sen"], correctIndex: 1, tense: "Strategie" },
                        { type: "fillblank", instruction: "L√∂se:", sentence: "4(x + 1) = 2(x + 7) ‚Üí x = _____", answer: "5", alternativeAnswers: [], tense: "Schwer" },
                        { type: "fillblank", instruction: "L√∂se:", sentence: "-2x + 10 = 4 ‚Üí x = _____", answer: "3", alternativeAnswers: [], tense: "Negativ" },
                        { type: "choice", instruction: "Was ist die L√∂sung von 5x = 0?", sentence: "", options: ["x = 5", "x = 0", "x = -5", "Keine L√∂sung"], correctIndex: 1, tense: "Sonderfall" },
                        { type: "fillblank", instruction: "L√∂se:", sentence: "x/2 + 3 = 7 ‚Üí x = _____", answer: "8", alternativeAnswers: [], tense: "Br√ºche" },
                        { type: "fillblank", instruction: "L√∂se:", sentence: "6x - 2 = 4x + 6 ‚Üí x = _____", answer: "4", alternativeAnswers: [], tense: "Beidseitig" },
                        { type: "choice", instruction: "Welche Gleichung hat x = 3 als L√∂sung?", sentence: "", options: ["2x + 1 = 5", "x + 5 = 9", "4x = 12", "x - 3 = 3"], correctIndex: 2, tense: "Probe" },
                        { type: "fillblank", instruction: "L√∂se:", sentence: "5(x - 1) - 2x = 10 ‚Üí x = _____", answer: "5", alternativeAnswers: [], tense: "Schwer" }
                    ]
                }
            ],
            "9-franzoesisch": [
                {
                    id: "avoir-etre",
                    name: "Avoir et √ätre",
                    desc: "Die wichtigsten Hilfsverben und ihre Verwendung",
                    icon: "üá´üá∑",
                    questions: 18,
                    hasAudio: true,
                    audioLang: "fr-FR",
                    theory: `<h3>üìö Avoir et √ätre</h3>
                        <h4>Avoir (haben)</h4>
                        <table><tr><th>Person</th><th>Form</th></tr>
                        <tr><td>j'</td><td>ai</td></tr>
                        <tr><td>tu</td><td>as</td></tr>
                        <tr><td>il/elle/on</td><td>a</td></tr>
                        <tr><td>nous</td><td>avons</td></tr>
                        <tr><td>vous</td><td>avez</td></tr>
                        <tr><td>ils/elles</td><td>ont</td></tr></table>
                        <h4>√ätre (sein)</h4>
                        <table><tr><th>Person</th><th>Form</th></tr>
                        <tr><td>je</td><td>suis</td></tr>
                        <tr><td>tu</td><td>es</td></tr>
                        <tr><td>il/elle/on</td><td>est</td></tr>
                        <tr><td>nous</td><td>sommes</td></tr>
                        <tr><td>vous</td><td>√™tes</td></tr>
                        <tr><td>ils/elles</td><td>sont</td></tr></table>
                        <h4>Pass√© Compos√©</h4>
                        <div class="rule-box"><strong>Mit √™tre:</strong> Bewegungsverben (aller, venir, arriver, partir...) und reflexive Verben<br>
                        <strong>Mit avoir:</strong> Die meisten anderen Verben</div>
                        <div class="example-box">J'ai mang√© (ich habe gegessen)<br>Je suis all√©(e) (ich bin gegangen)</div>`,
                    questionData: [
                        { type: "fillblank", instruction: "Konjugiere 'avoir':", sentence: "J'_____ un chien.", answer: "ai", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere 'avoir':", sentence: "Tu _____ 15 ans.", answer: "as", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere 'avoir':", sentence: "Elle _____ faim.", answer: "a", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere 'avoir':", sentence: "Nous _____ une voiture.", answer: "avons", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere 'avoir':", sentence: "Ils _____ trois enfants.", answer: "ont", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Je _____ fran√ßais.", answer: "suis", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Tu _____ fatigu√©.", answer: "es", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Il _____ grand.", answer: "est", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Nous _____ contents.", answer: "sommes", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Vous _____ allemands.", answer: "√™tes", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "fillblank", instruction: "Konjugiere '√™tre':", sentence: "Elles _____ belles.", answer: "sont", alternativeAnswers: [], tense: "Pr√©sent" },
                        { type: "choice", instruction: "Pass√© compos√©: Welches Hilfsverb f√ºr 'manger'?", sentence: "", options: ["√™tre", "avoir", "aller", "faire"], correctIndex: 1, tense: "Pass√© Compos√©" },
                        { type: "choice", instruction: "Pass√© compos√©: Welches Hilfsverb f√ºr 'aller'?", sentence: "", options: ["avoir", "√™tre", "venir", "faire"], correctIndex: 1, tense: "Pass√© Compos√©" },
                        { type: "fillblank", instruction: "Bilde das Pass√© compos√©:", sentence: "J'_____ mang√© une pizza. (avoir)", answer: "ai", alternativeAnswers: [], tense: "Pass√© Compos√©" },
                        { type: "fillblank", instruction: "Bilde das Pass√© compos√©:", sentence: "Elle _____ all√©e √† Paris. (√™tre)", answer: "est", alternativeAnswers: [], tense: "Pass√© Compos√©" },
                        { type: "choice", instruction: "Welcher Satz ist korrekt?", sentence: "", options: ["J'ai all√©", "Je suis all√©", "J'avoir all√©", "Je √™tre all√©"], correctIndex: 1, tense: "Pass√© Compos√©" },
                        { type: "fillblank", instruction: "√úbersetze:", sentence: "Ich habe = J'_____", answer: "ai", alternativeAnswers: [], tense: "√úbersetzung" },
                        { type: "fillblank", instruction: "√úbersetze:", sentence: "Ich bin = Je _____", answer: "suis", alternativeAnswers: [], tense: "√úbersetzung" }
                    ]
                }
            ],
            "9-biologie": [
                {
                    id: "blut-herz",
                    name: "Blut und Herz",
                    desc: "Blutkreislauf, Blutbestandteile und Herzfunktion",
                    icon: "‚ù§Ô∏è",
                    questions: 18,
                    hasAudio: false,
                    theory: `<h3>ü´Ä Blut und Herz</h3>
                        <h4>Blutbestandteile</h4>
                        <table><tr><th>Bestandteil</th><th>Funktion</th></tr>
                        <tr><td>Rote Blutk√∂rperchen (Erythrozyten)</td><td>Sauerstofftransport</td></tr>
                        <tr><td>Wei√üe Blutk√∂rperchen (Leukozyten)</td><td>Immunabwehr</td></tr>
                        <tr><td>Blutpl√§ttchen (Thrombozyten)</td><td>Blutgerinnung</td></tr>
                        <tr><td>Blutplasma</td><td>Transportmedium</td></tr></table>
                        <h4>Das Herz</h4>
                        <div class="rule-box">Das Herz hat <strong>4 Kammern</strong>: 2 Vorh√∂fe (Atrien) und 2 Herzkammern (Ventrikel)</div>
                        <h4>Blutkreislauf</h4>
                        <div class="example-box"><strong>Lungenkreislauf:</strong> Rechte Herzkammer ‚Üí Lunge ‚Üí Linker Vorhof<br>
                        <strong>K√∂rperkreislauf:</strong> Linke Herzkammer ‚Üí K√∂rper ‚Üí Rechter Vorhof</div>
                        <h4>Blutgruppen</h4>
                        <p>A, B, AB, 0 - unterschieden durch Antigene auf den roten Blutk√∂rperchen</p>`,
                    questionData: [
                        { type: "choice", instruction: "Welche Zellen transportieren Sauerstoff?", sentence: "", options: ["Wei√üe Blutk√∂rperchen", "Rote Blutk√∂rperchen", "Blutpl√§ttchen", "Blutplasma"], correctIndex: 1, tense: "Blut" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Rote Blutk√∂rperchen hei√üen auch _____.", answer: "Erythrozyten", alternativeAnswers: [], tense: "Fachbegriff" },
                        { type: "choice", instruction: "Welche Zellen sind f√ºr die Immunabwehr zust√§ndig?", sentence: "", options: ["Erythrozyten", "Leukozyten", "Thrombozyten", "Plasma"], correctIndex: 1, tense: "Blut" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "F√ºr die Blutgerinnung sind die _____ verantwortlich.", answer: "Blutpl√§ttchen", alternativeAnswers: ["Thrombozyten"], tense: "Blut" },
                        { type: "choice", instruction: "Wie viele Kammern hat das Herz?", sentence: "", options: ["2", "3", "4", "5"], correctIndex: 2, tense: "Herz" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Das Herz hat 2 Vorh√∂fe und 2 _____.", answer: "Herzkammern", alternativeAnswers: ["Ventrikel", "Kammern"], tense: "Herz" },
                        { type: "choice", instruction: "Wohin pumpt die rechte Herzkammer das Blut?", sentence: "", options: ["In den K√∂rper", "In die Lunge", "In den Kopf", "In die Beine"], correctIndex: 1, tense: "Kreislauf" },
                        { type: "choice", instruction: "Wohin pumpt die linke Herzkammer das Blut?", sentence: "", options: ["In die Lunge", "In den K√∂rper", "Ins Gehirn", "Ins Herz"], correctIndex: 1, tense: "Kreislauf" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Der fl√ºssige Teil des Blutes hei√üt _____.", answer: "Blutplasma", alternativeAnswers: ["Plasma"], tense: "Blut" },
                        { type: "choice", instruction: "Welche Blutgruppen gibt es im AB0-System?", sentence: "", options: ["A, B, C, D", "A, B, AB, 0", "1, 2, 3, 4", "Rot, Wei√ü, Blau"], correctIndex: 1, tense: "Blutgruppen" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Der Farbstoff in roten Blutk√∂rperchen hei√üt _____.", answer: "H√§moglobin", alternativeAnswers: [], tense: "Fachbegriff" },
                        { type: "choice", instruction: "Was transportiert das Blut NICHT?", sentence: "", options: ["Sauerstoff", "N√§hrstoffe", "Gedanken", "Hormone"], correctIndex: 2, tense: "Funktion" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Die Vorh√∂fe des Herzens hei√üen auch _____.", answer: "Atrien", alternativeAnswers: [], tense: "Fachbegriff" },
                        { type: "choice", instruction: "Wie oft schl√§gt das Herz etwa pro Minute (Erwachsener, Ruhe)?", sentence: "", options: ["30-40 mal", "60-80 mal", "100-120 mal", "150-180 mal"], correctIndex: 1, tense: "Fakten" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Im _____ wird das Blut mit Sauerstoff angereichert.", answer: "Lungenkreislauf", alternativeAnswers: ["kleinen Kreislauf"], tense: "Kreislauf" },
                        { type: "choice", instruction: "Welches Blutgef√§√ü f√ºhrt Blut zum Herzen?", sentence: "", options: ["Arterie", "Vene", "Kapillare", "Aorta"], correctIndex: 1, tense: "Gef√§√üe" },
                        { type: "fillblank", instruction: "Erg√§nze:", sentence: "Die gr√∂√üte Arterie des K√∂rpers ist die _____.", answer: "Aorta", alternativeAnswers: ["Hauptschlagader"], tense: "Gef√§√üe" },
                        { type: "choice", instruction: "Was ist der Unterschied zwischen Arterien und Venen?", sentence: "", options: ["Farbe des Blutes", "Arterien f√ºhren vom Herzen weg", "Venen sind dicker", "Kein Unterschied"], correctIndex: 1, tense: "Gef√§√üe" }
                    ]
                }
            ],
            "9-deutsch": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "9-geschichte": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "9-physik": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],
            "9-chemie": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }],

            // Default
            "default": [{ id: "coming-soon", name: "In Arbeit...", desc: "Neue Themen werden bald hinzugef√ºgt", icon: "üöß", questions: 0, comingSoon: true }]
        };

        // =====================================================
        // SPEECH API
        // =====================================================
        const synth = window.speechSynthesis;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isListening = false;
        let finalTranscript = '';
        let currentAudioLang = 'en-GB';

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
        }

        function speak(text, lang = currentAudioLang) {
            if (!synth) return;
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            const voices = synth.getVoices();
            const voice = voices.find(v => v.lang === lang) || voices.find(v => v.lang.startsWith(lang.split('-')[0]));
            if (voice) utterance.voice = voice;
            utterance.onend = () => document.getElementById('speakBtn')?.classList.remove('speaking');
            document.getElementById('speakBtn')?.classList.add('speaking');
            synth.speak(utterance);
        }

        if (synth) synth.onvoiceschanged = () => synth.getVoices();

        function startListening() {
            if (!recognition || isListening) return;
            recognition.lang = currentAudioLang;
            finalTranscript = '';
            document.getElementById('recognizedContent').textContent = '';
            document.getElementById('recognizedText').classList.add('show');
            document.getElementById('voiceVisualizer').classList.add('active');
            document.getElementById('listenBtn').classList.add('listening');
            document.getElementById('listenBtn').innerHTML = '‚èπÔ∏è Stopp';
            isListening = true;
            recognition.start();
        }

        function stopListening() {
            if (!recognition || !isListening) return;
            recognition.stop();
        }

        if (recognition) {
            recognition.onresult = (event) => {
                let interim = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) finalTranscript += event.results[i][0].transcript;
                    else interim += event.results[i][0].transcript;
                }
                document.getElementById('recognizedContent').textContent = finalTranscript + interim;
                const input = document.getElementById('answerInput');
                if (input) input.value = finalTranscript + interim;
            };
            recognition.onend = () => {
                isListening = false;
                document.getElementById('voiceVisualizer').classList.remove('active');
                document.getElementById('listenBtn').classList.remove('listening');
                document.getElementById('listenBtn').innerHTML = 'üé§ Sprechen';
            };
            recognition.onerror = () => {
                isListening = false;
                document.getElementById('voiceVisualizer').classList.remove('active');
                document.getElementById('listenBtn').classList.remove('listening');
                document.getElementById('listenBtn').innerHTML = 'üé§ Sprechen';
            };
        }

        // =====================================================
        // APP STATE
        // =====================================================
        let state = {
            loggedIn: false,
            selectedGrade: null,
            selectedSubject: null,
            selectedTopic: null,
            audioMode: false,
            questions: [],
            currentIndex: 0,
            correct: 0,
            wrong: 0,
            answered: false,
            completedModules: [],
            uploadedDocuments: []
        };

        function loadProgress() {
            const saved = localStorage.getItem('lerntrainer_progress');
            if (saved) {
                const data = JSON.parse(saved);
                state.completedModules = data.completedModules || [];
            }
        }

        function saveProgress() {
            localStorage.setItem('lerntrainer_progress', JSON.stringify({ completedModules: state.completedModules }));
        }

        // =====================================================
        // UI FUNCTIONS
        // =====================================================
        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('show');
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').classList.add('show');
            showGradeSelection();
            updateProgressBar();
        }

        function showGradeSelection() {
            document.getElementById('gradeSelection').style.display = 'block';
            document.getElementById('subjectSelection').style.display = 'none';
            document.getElementById('topicSelection').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('quizContainer').classList.remove('show');
            document.getElementById('progressSection').style.display = 'block';
            state.selectedGrade = null;
            state.selectedSubject = null;
            updateBreadcrumb();
        }

        function showSubjectSelection() {
            document.getElementById('gradeSelection').style.display = 'none';
            document.getElementById('subjectSelection').style.display = 'block';
            document.getElementById('topicSelection').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('quizContainer').classList.remove('show');
            state.selectedSubject = null;
            updateBreadcrumb();
        }

        function showTopicSelection() {
            document.getElementById('gradeSelection').style.display = 'none';
            document.getElementById('subjectSelection').style.display = 'none';
            document.getElementById('topicSelection').style.display = 'block';
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('quizContainer').classList.remove('show');
            renderTopics();
            updateBreadcrumb();
        }

        function showQuiz() {
            document.getElementById('gradeSelection').style.display = 'none';
            document.getElementById('subjectSelection').style.display = 'none';
            document.getElementById('topicSelection').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('quizContainer').classList.add('show');
            document.getElementById('questionArea').style.display = 'block';
            document.getElementById('resultScreen').classList.remove('show');
            document.getElementById('breadcrumb').innerHTML = '';
            startQuiz();
        }

        function updateBreadcrumb() {
            const bc = document.getElementById('breadcrumb');
            let html = `<div class="breadcrumb-item clickable" onclick="showGradeSelection()">üè† Start</div>`;
            if (state.selectedGrade) {
                html += `<span class="breadcrumb-arrow">‚Üí</span>`;
                html += `<div class="breadcrumb-item ${state.selectedSubject ? 'clickable' : ''}" ${state.selectedSubject ? 'onclick="showSubjectSelection()"' : ''}>Klasse ${state.selectedGrade}</div>`;
            }
            if (state.selectedSubject) {
                const subject = SUBJECTS.find(s => s.id === state.selectedSubject);
                html += `<span class="breadcrumb-arrow">‚Üí</span>`;
                html += `<div class="breadcrumb-item">${subject.icon} ${subject.name}</div>`;
            }
            bc.innerHTML = html;
        }

        function updateProgressBar() {
            const totalModules = Object.values(TOPICS).flat().filter(t => !t.comingSoon && t.questions > 0).length;
            const completed = state.completedModules.length;
            const percent = totalModules > 0 ? Math.round((completed / totalModules) * 100) : 0;
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressStats').textContent = `${completed} von ${totalModules} Modulen abgeschlossen`;
        }

        // =====================================================
        // RENDER
        // =====================================================
        function renderGrades() {
            document.getElementById('gradeGrid').innerHTML = GRADES.map(g => `
                <button class="selection-btn" data-grade="${g.id}">
                    <span class="icon">${g.icon}</span>
                    <span class="label">${g.name}</span>
                </button>
            `).join('');
        }

        function renderSubjects() {
            document.getElementById('subjectGrid').innerHTML = SUBJECTS.map(s => `
                <button class="selection-btn" data-subject="${s.id}">
                    <span class="icon">${s.icon}</span>
                    <span class="label">${s.name}</span>
                </button>
            `).join('');
        }

        function renderTopics() {
            const grid = document.getElementById('topicGrid');
            const key = `${state.selectedGrade}-${state.selectedSubject}`;
            const topics = TOPICS[key] || TOPICS['default'];
            
            grid.innerHTML = topics.map(t => {
                const moduleId = `${key}-${t.id}`;
                const isCompleted = state.completedModules.includes(moduleId);
                return `
                    <button class="topic-card ${t.comingSoon ? 'coming-soon' : ''}" data-topic="${t.id}" ${t.comingSoon ? 'disabled' : ''}>
                        <div class="topic-icon">${t.icon}</div>
                        <div class="topic-name">${t.name}</div>
                        <div class="topic-desc">${t.desc}</div>
                        <div class="topic-meta">
                            ${t.questions > 0 ? `<span class="topic-tag questions">${t.questions} Fragen</span>` : ''}
                            ${t.hasAudio ? '<span class="topic-tag audio">üé§ Audio</span>' : ''}
                            ${isCompleted ? '<span class="topic-tag completed">‚úì Abgeschlossen</span>' : ''}
                        </div>
                    </button>
                `;
            }).join('');
        }

        // =====================================================
        // FILE UPLOAD
        // =====================================================
        function setupUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const uploadInput = document.getElementById('uploadInput');

            uploadArea.addEventListener('click', () => uploadInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            uploadInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type === 'text/plain' || file.name.endsWith('.md') || file.name.endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        state.uploadedDocuments.push({
                            name: file.name,
                            size: file.size,
                            content: e.target.result
                        });
                        renderUploadedFiles();
                    };
                    reader.readAsText(file);
                } else {
                    state.uploadedDocuments.push({
                        name: file.name,
                        size: file.size,
                        content: `[Datei: ${file.name} - Inhalt kann nicht angezeigt werden]`
                    });
                    renderUploadedFiles();
                }
            });
        }

        function renderUploadedFiles() {
            const container = document.getElementById('uploadedFiles');
            const preview = document.getElementById('documentPreview');
            const content = document.getElementById('documentContent');
            
            if (state.uploadedDocuments.length === 0) {
                container.innerHTML = '';
                preview.style.display = 'none';
                return;
            }
            
            container.innerHTML = state.uploadedDocuments.map((doc, idx) => `
                <div class="uploaded-file">
                    <div class="uploaded-file-info">
                        <span class="uploaded-file-icon">üìÑ</span>
                        <span class="uploaded-file-name">${doc.name}</span>
                        <span class="uploaded-file-size">(${formatFileSize(doc.size)})</span>
                    </div>
                    <button class="uploaded-file-remove" onclick="removeFile(${idx})">‚úï</button>
                </div>
            `).join('');
            
            // Show combined content
            const allContent = state.uploadedDocuments.map(d => d.content).join('\n\n---\n\n');
            content.textContent = allContent;
            preview.style.display = 'block';
        }

        function removeFile(idx) {
            state.uploadedDocuments.splice(idx, 1);
            renderUploadedFiles();
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // =====================================================
        // QUIZ
        // =====================================================
        function startQuiz() {
            const key = `${state.selectedGrade}-${state.selectedSubject}`;
            const topics = TOPICS[key] || TOPICS['default'];
            const topic = topics.find(t => t.id === state.selectedTopic);
            
            if (!topic || !topic.questionData) return;
            
            // Set audio language
            currentAudioLang = topic.audioLang || 'de-DE';
            
            state.questions = shuffleArray([...topic.questionData]).slice(0, CONFIG.questionsPerQuiz);
            state.currentIndex = 0;
            state.correct = 0;
            state.wrong = 0;
            state.answered = false;
            
            document.getElementById('theorySection').innerHTML = topic.theory || '';
            document.getElementById('theorySection').classList.remove('show');
            document.getElementById('modeToggle').style.display = topic.hasAudio ? 'flex' : 'none';
            document.getElementById('audioControls').style.display = state.audioMode && topic.hasAudio ? 'flex' : 'none';
            
            updateQuizStats();
            showQuestion();
        }

        function showQuestion() {
            const q = state.questions[state.currentIndex];
            state.answered = false;
            
            document.getElementById('recognizedText').classList.remove('show');
            document.getElementById('voiceVisualizer').classList.remove('active');
            
            document.getElementById('questionNumber').textContent = `Frage ${state.currentIndex + 1}/${state.questions.length}`;
            document.getElementById('questionType').textContent = {
                'fillblank': 'L√ºckentext', 'transform': 'Umwandeln', 'choice': 'Multiple Choice'
            }[q.type] || q.type;
            document.getElementById('questionTense').textContent = q.tense || '';
            
            let html = `<p>${q.instruction}</p>`;
            if (q.sentence) html += `<div class="sentence-box">${q.sentence}</div>`;
            document.getElementById('questionText').innerHTML = html;
            
            const area = document.getElementById('answerArea');
            if (q.type === 'choice') {
                area.innerHTML = `<div class="options-grid">${q.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        ${opt}
                    </button>
                `).join('')}</div>`;
            } else {
                area.innerHTML = `<input type="text" class="answer-input" id="answerInput" placeholder="${state.audioMode ? 'Deine Antwort erscheint hier...' : 'Deine Antwort eingeben...'}" autocomplete="off" spellcheck="false">`;
                if (!state.audioMode) setTimeout(() => document.getElementById('answerInput')?.focus(), 100);
            }
            
            if (state.audioMode) {
                setTimeout(() => speak(q.instruction.replace(/<[^>]*>/g, '') + ' ' + (q.sentence || '')), 300);
            }
            
            document.getElementById('checkBtn').style.display = 'inline-flex';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('feedback').classList.remove('show', 'correct', 'incorrect');
        }

        function checkAnswer() {
            const q = state.questions[state.currentIndex];
            let isCorrect = false;
            
            if (q.type === 'choice') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('Bitte w√§hle eine Antwort!'); return; }
                isCorrect = parseInt(selected.dataset.index) === q.correctIndex;
                document.querySelectorAll('.option-btn').forEach((btn, i) => {
                    btn.classList.add('disabled');
                    if (i === q.correctIndex) btn.classList.add('correct');
                    else if (btn.classList.contains('selected') && !isCorrect) btn.classList.add('incorrect');
                });
            } else {
                const input = document.getElementById('answerInput');
                const userAnswer = input.value.trim();
                if (!userAnswer) { alert('Bitte gib eine Antwort ein!'); return; }
                
                const normalize = s => s.toLowerCase().replace(/[.,!?'"¬¥`]/g, '').replace(/\s+/g, ' ').trim();
                isCorrect = normalize(userAnswer) === normalize(q.answer);
                if (!isCorrect && q.alternativeAnswers) {
                    isCorrect = q.alternativeAnswers.some(a => normalize(a) === normalize(userAnswer));
                }
                
                // Flexible number matching
                if (!isCorrect && /^\d+$/.test(userAnswer) && /^\d+$/.test(q.answer)) {
                    isCorrect = parseInt(userAnswer) === parseInt(q.answer);
                }
                
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
                input.disabled = true;
            }
            
            if (isCorrect) state.correct++; else state.wrong++;
            updateQuizStats();
            
            const fb = document.getElementById('feedback');
            fb.className = 'feedback show ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackTitle').innerHTML = isCorrect ? '‚úÖ Richtig!' : '‚ùå Nicht ganz richtig';
            document.getElementById('feedbackText').innerHTML = isCorrect ? '' : `Die richtige Antwort: <span class="correct-answer">${q.answer}</span>`;
            
            if (state.audioMode) speak(isCorrect ? 'Correct!' : 'The correct answer is: ' + q.answer);
            
            state.answered = true;
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-flex';
            document.getElementById('nextBtn').textContent = state.currentIndex < state.questions.length - 1 ? 'N√§chste Frage ‚Üí' : 'Ergebnis ‚Üí';
        }

        function nextQuestion() {
            state.currentIndex++;
            if (state.currentIndex < state.questions.length) showQuestion();
            else showResults();
        }

        function showResults() {
            document.getElementById('questionArea').style.display = 'none';
            document.getElementById('resultScreen').classList.add('show');
            
            const percent = Math.round((state.correct / state.questions.length) * 100);
            let emoji = 'üí™', title = 'Weiter √ºben!';
            if (percent >= 90) { emoji = 'üèÜ'; title = 'Hervorragend!'; }
            else if (percent >= 70) { emoji = 'üéâ'; title = 'Sehr gut!'; }
            else if (percent >= 50) { emoji = 'üëç'; title = 'Gut gemacht!'; }
            
            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = percent + '%';
            document.getElementById('resultText').textContent = `Du hast ${state.correct} von ${state.questions.length} Fragen richtig.`;
            
            if (percent >= 70) {
                const moduleId = `${state.selectedGrade}-${state.selectedSubject}-${state.selectedTopic}`;
                if (!state.completedModules.includes(moduleId)) {
                    state.completedModules.push(moduleId);
                    saveProgress();
                }
            }
        }

        function updateQuizStats() {
            document.getElementById('statTotal').textContent = state.questions.length;
            document.getElementById('statCorrect').textContent = state.correct;
            document.getElementById('statWrong').textContent = state.wrong;
            const total = state.correct + state.wrong;
            document.getElementById('statPercent').textContent = (total > 0 ? Math.round((state.correct / total) * 100) : 0) + '%';
        }

        function shuffleArray(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        // =====================================================
        // EVENT LISTENERS
        // =====================================================
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            renderGrades();
            renderSubjects();
            setupUpload();
            
            if (sessionStorage.getItem('lerntrainer_logged_in')) showApp();
            
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('passwordInput').addEventListener('keypress', e => { if (e.key === 'Enter') handleLogin(); });
            
            function handleLogin() {
                const pw = document.getElementById('passwordInput').value;
                if (pw === CONFIG.password) {
                    sessionStorage.setItem('lerntrainer_logged_in', 'true');
                    showApp();
                } else {
                    document.getElementById('passwordInput').classList.add('error');
                    document.getElementById('loginError').classList.add('show');
                    setTimeout(() => document.getElementById('passwordInput').classList.remove('error'), 500);
                }
            }
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                sessionStorage.removeItem('lerntrainer_logged_in');
                showLogin();
            });
            
            document.getElementById('gradeGrid').addEventListener('click', e => {
                const btn = e.target.closest('.selection-btn');
                if (!btn) return;
                document.querySelectorAll('#gradeGrid .selection-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.selectedGrade = parseInt(btn.dataset.grade);
                setTimeout(showSubjectSelection, 200);
            });
            
            document.getElementById('subjectGrid').addEventListener('click', e => {
                const btn = e.target.closest('.selection-btn');
                if (!btn) return;
                document.querySelectorAll('#subjectGrid .selection-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.selectedSubject = btn.dataset.subject;
                setTimeout(showTopicSelection, 200);
            });
            
            document.getElementById('topicGrid').addEventListener('click', e => {
                const card = e.target.closest('.topic-card');
                if (!card || card.classList.contains('coming-soon')) return;
                state.selectedTopic = card.dataset.topic;
                showQuiz();
            });
            
            document.getElementById('checkBtn').addEventListener('click', checkAnswer);
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            document.getElementById('restartBtn').addEventListener('click', () => {
                document.getElementById('questionArea').style.display = 'block';
                document.getElementById('resultScreen').classList.remove('show');
                startQuiz();
            });
            document.getElementById('backToTopics').addEventListener('click', () => {
                if (synth) synth.cancel();
                showTopicSelection();
                document.getElementById('progressSection').style.display = 'block';
                updateProgressBar();
            });
            document.getElementById('backToTopicsResult').addEventListener('click', () => {
                showTopicSelection();
                document.getElementById('progressSection').style.display = 'block';
                updateProgressBar();
            });
            
            document.getElementById('theoryToggle').addEventListener('click', () => {
                document.getElementById('theorySection').classList.toggle('show');
            });
            
            document.getElementById('audioToggle').addEventListener('click', () => {
                state.audioMode = !state.audioMode;
                document.getElementById('audioToggle').classList.toggle('active', state.audioMode);
                document.getElementById('audioControls').style.display = state.audioMode ? 'flex' : 'none';
            });
            
            document.getElementById('speakBtn').addEventListener('click', () => {
                const q = state.questions[state.currentIndex];
                speak(q.instruction.replace(/<[^>]*>/g, '') + ' ' + (q.sentence || ''));
            });
            document.getElementById('listenBtn').addEventListener('click', () => {
                if (isListening) stopListening(); else startListening();
            });
            
            document.getElementById('answerArea').addEventListener('click', e => {
                const btn = e.target.closest('.option-btn');
                if (!btn || state.answered) return;
                document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            });
            
            document.addEventListener('keydown', e => {
                if (e.key === 'Enter' && document.getElementById('quizContainer').classList.contains('show')) {
                    if (!state.answered) checkAnswer();
                    else nextQuestion();
                }
            });
        });
    </script>
</body>
</html>
